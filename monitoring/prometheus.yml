# Prometheus Configuration for Big Three Realtime Agents
#
# Scrapes metrics from all services and provides query interface
# for Grafana dashboards and alerting.

global:
  scrape_interval: 15s  # Default scrape interval
  evaluation_interval: 15s  # Rule evaluation interval
  scrape_timeout: 10s  # Scrape timeout

  # Labels attached to all metrics
  external_labels:
    cluster: 'big-three-agents'
    environment: 'production'

# Alertmanager configuration (optional)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           - 'alertmanager:9093'

# Rule files for alerts (optional)
# rule_files:
#   - '/etc/prometheus/alerts/*.yml'

# Scrape configurations
scrape_configs:
  # ============================================================================
  # Prometheus Self-Monitoring
  # ============================================================================
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

  # ============================================================================
  # Observability Server Metrics
  # ============================================================================
  - job_name: 'observability-server'
    scrape_interval: 10s  # More frequent for real-time monitoring
    static_configs:
      - targets: ['observability-server:4000']
        labels:
          service: 'observability-server'
          component: 'backend'

    # Metrics path (default is /metrics)
    metrics_path: '/metrics'

    # Relabeling for better metric organization
    metric_relabel_configs:
      - source_labels: [__name__]
        regex: 'http_.*'
        target_label: 'metric_type'
        replacement: 'http'
      - source_labels: [__name__]
        regex: 'websocket_.*'
        target_label: 'metric_type'
        replacement: 'websocket'

  # ============================================================================
  # Big Three Agents Metrics
  # ============================================================================
  - job_name: 'big-three-agents'
    scrape_interval: 15s
    static_configs:
      - targets: ['big-three-agents:8000']
        labels:
          service: 'big-three-agents'
          component: 'voice-agent'

    # Metrics endpoint (to be implemented)
    metrics_path: '/metrics'

    metric_relabel_configs:
      - source_labels: [__name__]
        regex: 'agent_.*'
        target_label: 'metric_type'
        replacement: 'agent'
      - source_labels: [__name__]
        regex: 'api_.*'
        target_label: 'metric_type'
        replacement: 'api'

  # ============================================================================
  # Redis Metrics (via redis_exporter if installed)
  # ============================================================================
  # Uncomment if using redis_exporter sidecar
  # - job_name: 'redis'
  #   static_configs:
  #     - targets: ['redis:9121']
  #       labels:
  #         service: 'redis'

  # ============================================================================
  # Node Exporter (system metrics - optional)
  # ============================================================================
  # Uncomment if using node_exporter
  # - job_name: 'node'
  #   static_configs:
  #     - targets: ['node-exporter:9100']
  #       labels:
  #         service: 'node-exporter'

  # ============================================================================
  # Custom Application Metrics
  # ============================================================================
  # Add custom scrape targets as needed
  # - job_name: 'custom-service'
  #   static_configs:
  #     - targets: ['service:port']

# ============================================================================
# Storage Configuration
# ============================================================================
storage:
  tsdb:
    # Data retention period
    retention.time: 15d  # Keep 15 days of data
    retention.size: 10GB  # Max 10GB storage

    # Compression
    compression: true

# ============================================================================
# Query Configuration
# ============================================================================
# Limit on concurrent queries
query:
  max_concurrency: 20
  timeout: 2m

# ============================================================================
# Remote Write (optional - for long-term storage)
# ============================================================================
# remote_write:
#   - url: 'https://your-remote-storage.com/api/v1/write'
#     basic_auth:
#       username: 'your-username'
#       password: 'your-password'
